#!/usr/bin/env bash
#
# Safety wrapper â€“ blocks destructive Docker commands
#
set -euo pipefail

# -------- guard 1: ban docker compose down -v ----------
if [[ "$*" =~ down[[:space:]]+-v ]]; then
    printf "ðŸš«  'docker compose down -v' is disabled â€” volume wipe blocked.\n"
    exit 13
fi

# -------- guard 2: prod volume protection --------------
if [[ "${LEDGER_ENV:-dev}" == "prod" ]] && [[ "$*" =~ (exec|run).*(-U|--user).*postgres ]]; then
    printf "ðŸš«  Direct psql access to prod DB blocked.\n"
    exit 13
fi

# -------- pass-through --------------------------------
command docker "$@" 